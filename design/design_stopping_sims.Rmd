---
title: "Design how to save atomic stopping rule results in simulations and report them"
output: 
  html_document:
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Objective 

Currently there is no information returned about stopping rules / frequency during scenario simulation. We would like to add a counting feature and a reporting feature for individual and complex / combined stopping rules. 
We need to count instances in which a stopping rule is TRUE. In case we have combined (BOOLEAN logic) stopping rules we would like to summarize (concatenate) before outputting to the console.   
Additionally differentiate between first hit and "all other" (otherwise might add up to more than 100 %).

## Current implementation suggestion

* How to get the name of a stopping rule, i.e. get the class name (not really human friendly) or should we have a slot in stopping rule classes (would require manual adjustment of all stopping rule classes) - requires to be present in all classes otherwise will throw errors

For option one we would have to add a slot to the rule class, so that we can refer to the name slot later.
```{r class.source = 'fold-hide', message = F, warning = F}
devtools::load_all()
.StoppingMinCohorts <-
    setClass(Class="StoppingMinCohorts",
             representation(nCohorts="integer",
                            name = "character"),
             prototype(nCohorts=3L, name = "minimum required number of cohorts"),
             contains="Stopping",
             validity=function(object){
                 o <- Validate()

                 o$check((object@nCohorts > 0L) && is.scalar(object@nCohorts),
                         "nCohorts must be positive scalar")

                 o$result()
             })
#validObject(.StoppingMinCohorts())


StoppingMinCohorts <- function(nCohorts, name)
{
    .StoppingMinCohorts(nCohorts=safeInteger(nCohorts))
}

```


The two options we have to print the stopping rule name later: 
```{r}

myStopping1 <- StoppingMinCohorts(nCohorts=3)

myStopping1@name

class(myStopping1)
```

* Extract "hit" (TRUE) from stopping rules object 
* Go step-by-step through all the objects affected by a simulation; need for adjustment?

## Unpack combined stopping rules

In order to be general enough for all stopping rules, we also need to be able
to process combined stopping rules (and / or combinations).

Clara will explain how that works in more detail (main effort)
