<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function returns whether to stop the trial.
Stopping rule based precision of the MTD estimation.
The trial is stopped, when the MTD can be estimated with sufficient precision.
The criteria is based on the robust coefficient of variation (CV) calculated
from the posterior distribution.
The robust CV is defined mad(MTD) / median(MTD), where mad is the median
absolute deviation.
Stopping based based on the lowest non placebo dose. The trial is
stopped when the lowest non placebo dose meets the Hard
Safety Rule, i.e. it is deemed to be overly toxic. Stopping is based on the
observed data at the lowest dose level using a Bin-Beta model
based on DLT probability."><title>Stop the trial? — stopTrial • crmPack</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Stop the trial? — stopTrial"><meta property="og:description" content="This function returns whether to stop the trial.
Stopping rule based precision of the MTD estimation.
The trial is stopped, when the MTD can be estimated with sufficient precision.
The criteria is based on the robust coefficient of variation (CV) calculated
from the posterior distribution.
The robust CV is defined mad(MTD) / median(MTD), where mad is the median
absolute deviation.
Stopping based based on the lowest non placebo dose. The trial is
stopped when the lowest non placebo dose meets the Hard
Safety Rule, i.e. it is deemed to be overly toxic. Stopping is based on the
observed data at the lowest dose level using a Bin-Beta model
based on DLT probability."><meta property="og:image" content="https://roche.github.io/crmPack/main/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">crmPack</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.9000.9133</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/trial_definition.html">Trial Definition</a>
    <a class="dropdown-item" href="../articles/trial_analysis.html">Trial Analysis</a>
    <a class="dropdown-item" href="../articles/trial_simulation.html">Trial Simulation</a>
    <a class="dropdown-item" href="../articles/rolling-crm.html">Rolling CRM Example</a>
    <a class="dropdown-item" href="../articles/simulations.html">Simulation study example</a>
    <a class="dropdown-item" href="../articles/migration_from_the_old_crmPack.html">Migrating from crmPack version 1.0.3</a>
    <a class="dropdown-item" href="../articles/parallel_computing_with_extensions.html">Parallel computing with extensions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<!-- start dropdown for versions --> <li class="nav-item dropdown">
        <a href="#" class="nav-link dropdown-toggle"
          data-bs-toggle="dropdown" role="button"
          aria-expanded="false" aria-haspopup="true"
          id="dropdown-versions">Versions</a> <div class="dropdown-menu" aria-labelledby="dropdown-versions"> <a class="dropdown-item" data-toggle="tooltip" title="" href="https://Roche.github.io/crmPack/main">main</a> </div></li>
<!-- end dropdown for versions -->
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/roche/crmPack">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Stop the trial?</h1>
      <small class="dont-index">Source: <a href="https://github.com/roche/crmPack/blob/HEAD/R/Rules-methods.R" class="external-link"><code>R/Rules-methods.R</code></a></small>
      <div class="d-none name"><code>stopTrial.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function returns whether to stop the trial.</p>
<p>Stopping rule based precision of the MTD estimation.
The trial is stopped, when the MTD can be estimated with sufficient precision.
The criteria is based on the robust coefficient of variation (CV) calculated
from the posterior distribution.
The robust CV is defined <code>mad(MTD) / median(MTD)</code>, where <code>mad</code> is the median
absolute deviation.</p>
<p>Stopping based based on the lowest non placebo dose. The trial is
stopped when the lowest non placebo dose meets the Hard
Safety Rule, i.e. it is deemed to be overly toxic. Stopping is based on the
observed data at the lowest dose level using a Bin-Beta model
based on DLT probability.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingList,ANY,ANY,ANY,ANY</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingAll,ANY,ANY,ANY,ANY</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingAny,ANY,ANY,ANY,ANY</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingCohortsNearDose,numeric,ANY,ANY,Data</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingPatientsNearDose,numeric,ANY,ANY,Data</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingMinCohorts,ANY,ANY,ANY,Data</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingMinPatients,ANY,ANY,ANY,Data</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingTargetProb,numeric,Samples,GeneralModel,ANY</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingMTDdistribution,numeric,Samples,GeneralModel,ANY</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingMTDCV,numeric,Samples,GeneralModel,ANY</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingLowestDoseHSRBeta,numeric,Samples,ANY,ANY</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingTargetBiomarker,numeric,Samples,DualEndpoint,ANY</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingSpecificDose,numeric,ANY,ANY,Data</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingHighestDose,numeric,ANY,ANY,Data</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingTDCIRatio,ANY,Samples,ModelTox,ANY</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingTDCIRatio,ANY,missing,ModelTox,ANY</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingMaxGainCIRatio,ANY,Samples,ModelTox,DataDual</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span></span>
<span>  <span class="va">stopping</span>,</span>
<span>  <span class="va">dose</span>,</span>
<span>  <span class="va">samples</span>,</span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">TDderive</span>,</span>
<span>  <span class="va">Effmodel</span>,</span>
<span>  <span class="va">Effsamples</span>,</span>
<span>  <span class="va">Gstarderive</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for StoppingMaxGainCIRatio,ANY,missing,ModelTox,DataDual</span></span>
<span><span class="fu">stopTrial</span><span class="op">(</span><span class="va">stopping</span>, <span class="va">dose</span>, <span class="va">model</span>, <span class="va">data</span>, <span class="va">Effmodel</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>stopping</dt>
<dd><p>The rule, an object of class
<code><a href="Stopping-class.html">Stopping</a></code></p></dd>


<dt>dose</dt>
<dd><p>the recommended next best dose</p></dd>


<dt>samples</dt>
<dd><p>the <code><a href="Samples-class.html">Samples</a></code> object</p></dd>


<dt>model</dt>
<dd><p>The model input, an object of class <code><a href="GeneralModel-class.html">GeneralModel</a></code></p></dd>


<dt>data</dt>
<dd><p>The data input, an object of class <code><a href="Data-class.html">Data</a></code></p></dd>


<dt>...</dt>
<dd><p>additional arguments</p></dd>


<dt>TDderive</dt>
<dd><p>the function which derives from the input, a vector of the posterior samples called
<code>TDsamples</code> of the dose
which has the probability of the occurrence of DLE equals to either the targetDuringTrial or
targetEndOfTrial, the final next best TDtargetDuringTrial (the dose with probability of the
occurrence of DLE equals to the targetDuringTrial)and TDtargetEndOfTrial estimate.</p></dd>


<dt>Effmodel</dt>
<dd><p>the efficacy model of <code><a href="ModelEff-class.html">ModelEff</a></code> class object</p></dd>


<dt>Effsamples</dt>
<dd><p>the efficacy samples of <code><a href="Samples-class.html">Samples</a></code> class object</p></dd>


<dt>Gstarderive</dt>
<dd><p>the function which derives from the input, a vector of the posterior Gstar (the dose
which gives the maximum gain value) samples
called <code>Gstarsamples</code>, the final next best Gstar estimate.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>logical value: <code>TRUE</code> if the trial can be stopped, <code>FALSE</code></p>


<p>otherwise. It should have an attribute <code>message</code> which gives the reason
for the decision.</p>
    </div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>
    
<ul><li><p><code>stopTrial(
  stopping = StoppingList,
  dose = ANY,
  samples = ANY,
  model = ANY,
  data = ANY
)</code>: Stop based on multiple stopping rules</p></li>
<li><p><code>stopTrial(
  stopping = StoppingAll,
  dose = ANY,
  samples = ANY,
  model = ANY,
  data = ANY
)</code>: Stop based on fulfillment of all multiple stopping
rules</p></li>
<li><p><code>stopTrial(
  stopping = StoppingAny,
  dose = ANY,
  samples = ANY,
  model = ANY,
  data = ANY
)</code>: Stop based on fulfillment of any stopping rule</p></li>
<li><p><code>stopTrial(
  stopping = StoppingCohortsNearDose,
  dose = numeric,
  samples = ANY,
  model = ANY,
  data = Data
)</code>: Stop based on number of cohorts near to next best dose</p></li>
<li><p><code>stopTrial(
  stopping = StoppingPatientsNearDose,
  dose = numeric,
  samples = ANY,
  model = ANY,
  data = Data
)</code>: Stop based on number of patients near to next best
dose</p></li>
<li><p><code>stopTrial(
  stopping = StoppingMinCohorts,
  dose = ANY,
  samples = ANY,
  model = ANY,
  data = Data
)</code>: Stop based on minimum number of cohorts</p></li>
<li><p><code>stopTrial(
  stopping = StoppingMinPatients,
  dose = ANY,
  samples = ANY,
  model = ANY,
  data = Data
)</code>: Stop based on minimum number of patients</p></li>
<li><p><code>stopTrial(
  stopping = StoppingTargetProb,
  dose = numeric,
  samples = Samples,
  model = GeneralModel,
  data = ANY
)</code>: Stop based on probability of target tox interval</p></li>
<li><p><code>stopTrial(
  stopping = StoppingMTDdistribution,
  dose = numeric,
  samples = Samples,
  model = GeneralModel,
  data = ANY
)</code>: Stop based on MTD distribution</p></li>
<li><p><code>stopTrial(
  stopping = StoppingTargetBiomarker,
  dose = numeric,
  samples = Samples,
  model = DualEndpoint,
  data = ANY
)</code>: Stop based on probability of targeting biomarker</p></li>
<li><p><code>stopTrial(
  stopping = StoppingSpecificDose,
  dose = numeric,
  samples = ANY,
  model = ANY,
  data = Data
)</code>: if Stopping rule is met for specific dose of the planned
dose grid and not just for the default next best dose.</p></li>
<li><p><code>stopTrial(
  stopping = StoppingHighestDose,
  dose = numeric,
  samples = ANY,
  model = ANY,
  data = Data
)</code>: Stop when the highest dose is reached</p></li>
<li><p><code>stopTrial(
  stopping = StoppingTDCIRatio,
  dose = ANY,
  samples = Samples,
  model = ModelTox,
  data = ANY
)</code>: Stop based on 'StoppingTDCIRatio' class when
reaching the target ratio of the upper to the lower 95% credibility
interval of the estimate (TDtargetEndOfTrial). This is a stopping rule which incorporate only
DLE responses and DLE samples are given</p></li>
<li><p><code>stopTrial(
  stopping = StoppingTDCIRatio,
  dose = ANY,
  samples = missing,
  model = ModelTox,
  data = ANY
)</code>: Stop based on 'StoppingTDCIRatio' class
when reaching the target ratio of the upper to the lower 95% credibility
interval of the estimate (TDtargetEndOfTrial). This is a stopping rule which incorporate only
DLE responses and no DLE samples are involved</p></li>
<li><p><code>stopTrial(
  stopping = StoppingMaxGainCIRatio,
  dose = ANY,
  samples = Samples,
  model = ModelTox,
  data = DataDual
)</code>: Stop based on reaching the target ratio of the upper to the lower 95% credibility
interval of the estimate (the minimum of Gstar and TDtargetEndOfTrial). This is a stopping rule which
incorporate DLE and efficacy responses and DLE and efficacy samples are also used.</p></li>
<li><p><code>stopTrial(
  stopping = StoppingMaxGainCIRatio,
  dose = ANY,
  samples = missing,
  model = ModelTox,
  data = DataDual
)</code>: Stop based on reaching the target ratio of the upper to the lower 95% credibility
interval of the estimate (the minimum of Gstar and TDtargetEndOfTrial). This is a stopping rule which
incorporate DLE and efficacy responses without DLE and efficacy samples involved.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example of combining stopping rules with '&amp;' and/or '|' operators</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">myStopping1</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingMinCohorts-class.html">StoppingMinCohorts</a></span><span class="op">(</span>nCohorts<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">myStopping2</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingTargetProb-class.html">StoppingTargetProb</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  prob<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">myStopping3</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingMinPatients-class.html">StoppingMinPatients</a></span><span class="op">(</span>nPatients<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">myStopping1</span> <span class="op">&amp;</span> <span class="va">myStopping2</span><span class="op">)</span> <span class="op">|</span> <span class="va">myStopping3</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint start</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create some data</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="Data-class.html">Data</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             cohort<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             doseGrid<span class="op">=</span></span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span></span>
<span class="r-in"><span>                 <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">10</span>, to<span class="op">=</span><span class="fl">80</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initialize the CRM model used to model the data</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="LogisticLogNormal-class.html">LogisticLogNormal</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.85</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           cov<span class="op">=</span></span></span>
<span class="r-in"><span>                             <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                    nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           ref_dose<span class="op">=</span><span class="fl">56</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set-up some MCMC parameters and generate samples from the posterior</span></span></span>
<span class="r-in"><span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>burnin<span class="op">=</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>                       step<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                       samples<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">94</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span>, <span class="va">options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule for dose increments and calculate the maximum dose allowed</span></span></span>
<span class="r-in"><span><span class="va">myIncrements</span> <span class="op">&lt;-</span> <span class="fu"><a href="IncrementsRelative-class.html">IncrementsRelative</a></span><span class="op">(</span>intervals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   increments<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.33</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">myIncrements</span>,</span></span>
<span class="r-in"><span>                       data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule which will be used to select the next best dose</span></span></span>
<span class="r-in"><span><span class="co"># based on the class 'NextBestNCRM'</span></span></span>
<span class="r-in"><span><span class="va">myNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestNCRM-class.html">NextBestNCRM</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           overdose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           max_overdose_prob<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the next best dose</span></span></span>
<span class="r-in"><span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">myNextBest</span>,</span></span>
<span class="r-in"><span>                               doselimit<span class="op">=</span><span class="va">nextMaxDose</span>,</span></span>
<span class="r-in"><span>                               samples<span class="op">=</span><span class="va">samples</span>, model<span class="op">=</span><span class="va">model</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the stopping rules</span></span></span>
<span class="r-in"><span><span class="va">myStopping1</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingMinCohorts-class.html">StoppingMinCohorts</a></span><span class="op">(</span>nCohorts<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">myStopping2</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingTargetProb-class.html">StoppingTargetProb</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  prob<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">myStopping3</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingMinPatients-class.html">StoppingMinPatients</a></span><span class="op">(</span>nPatients<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create a list of stopping rules (of class 'StoppingList') which will then be</span></span></span>
<span class="r-in"><span><span class="co"># summarized (in this specific example) with the 'any' function, meaning that the study</span></span></span>
<span class="r-in"><span><span class="co"># would be stopped if 'any' of the single stopping rules is TRUE.</span></span></span>
<span class="r-in"><span><span class="va">mystopping</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingList-class.html">StoppingList</a></span><span class="op">(</span>stop_list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">myStopping1</span>,<span class="va">myStopping2</span>,<span class="va">myStopping3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           summary<span class="op">=</span><span class="va">any</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate if to stop the Trial</span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span>stopping<span class="op">=</span><span class="va">myStopping</span>, dose<span class="op">=</span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span></span>
<span class="r-in"><span>          samples<span class="op">=</span><span class="va">samples</span>, model<span class="op">=</span><span class="va">model</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[1]][[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Number of cohorts is 6 and thus reached the prespecified minimum number 3"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[1]][[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Probability for target toxicity is 35 % for dose 20 and thus below the required 50 %"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Number of patients is 8 and thus below the prespecified minimum number 20"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint end</span></span></span>
<span class="r-in"><span><span class="co"># nolint start</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create some data</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="Data-class.html">Data</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             cohort<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             doseGrid<span class="op">=</span></span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span></span>
<span class="r-in"><span>                 <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">10</span>, to<span class="op">=</span><span class="fl">80</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initialize the CRM model used to model the data</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="LogisticLogNormal-class.html">LogisticLogNormal</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.85</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           cov<span class="op">=</span></span></span>
<span class="r-in"><span>                             <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                    nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           ref_dose<span class="op">=</span><span class="fl">56</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set-up some MCMC parameters and generate samples from the posterior</span></span></span>
<span class="r-in"><span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>burnin<span class="op">=</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>                       step<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                       samples<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">94</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span>, <span class="va">options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule for dose increments and calculate the maximum dose allowed</span></span></span>
<span class="r-in"><span><span class="va">myIncrements</span> <span class="op">&lt;-</span> <span class="fu"><a href="IncrementsRelative-class.html">IncrementsRelative</a></span><span class="op">(</span>intervals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   increments<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.33</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">myIncrements</span>,</span></span>
<span class="r-in"><span>                       data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule which will be used to select the next best dose</span></span></span>
<span class="r-in"><span><span class="co"># based on the class 'NextBestNCRM'</span></span></span>
<span class="r-in"><span><span class="va">myNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestNCRM-class.html">NextBestNCRM</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           overdose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           max_overdose_prob<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the next best dose</span></span></span>
<span class="r-in"><span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">myNextBest</span>,</span></span>
<span class="r-in"><span>                               doselimit<span class="op">=</span><span class="va">nextMaxDose</span>,</span></span>
<span class="r-in"><span>                               samples<span class="op">=</span><span class="va">samples</span>, model<span class="op">=</span><span class="va">model</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the stopping rules</span></span></span>
<span class="r-in"><span><span class="va">myStopping1</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingMinCohorts-class.html">StoppingMinCohorts</a></span><span class="op">(</span>nCohorts<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">myStopping2</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingTargetProb-class.html">StoppingTargetProb</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  prob<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">myStopping3</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingMinPatients-class.html">StoppingMinPatients</a></span><span class="op">(</span>nPatients<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Combine the stopping rules, obtaining (in this specific example) a list of stopping</span></span></span>
<span class="r-in"><span><span class="co"># rules of class 'StoppingAll'</span></span></span>
<span class="r-in"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">myStopping1</span> <span class="op">|</span> <span class="va">myStopping2</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">myStopping3</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate if to stop the Trial</span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span>stopping<span class="op">=</span><span class="va">myStopping</span>, dose<span class="op">=</span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span></span>
<span class="r-in"><span>          samples<span class="op">=</span><span class="va">samples</span>, model<span class="op">=</span><span class="va">model</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[1]][[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Number of cohorts is 6 and thus reached the prespecified minimum number 3"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[1]][[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Probability for target toxicity is 35 % for dose 20 and thus below the required 50 %"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Number of patients is 8 and thus below the prespecified minimum number 20"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint end</span></span></span>
<span class="r-in"><span><span class="co"># nolint start</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create some data</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="Data-class.html">Data</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             cohort<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             doseGrid<span class="op">=</span></span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span></span>
<span class="r-in"><span>                 <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">10</span>, to<span class="op">=</span><span class="fl">80</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initialize the CRM model used to model the data</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="LogisticLogNormal-class.html">LogisticLogNormal</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.85</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           cov<span class="op">=</span></span></span>
<span class="r-in"><span>                             <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                    nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           ref_dose<span class="op">=</span><span class="fl">56</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set-up some MCMC parameters and generate samples from the posterior</span></span></span>
<span class="r-in"><span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>burnin<span class="op">=</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>                       step<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                       samples<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">94</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span>, <span class="va">options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule for dose increments and calculate the maximum dose allowed</span></span></span>
<span class="r-in"><span><span class="va">myIncrements</span> <span class="op">&lt;-</span> <span class="fu"><a href="IncrementsRelative-class.html">IncrementsRelative</a></span><span class="op">(</span>intervals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   increments<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.33</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">myIncrements</span>,</span></span>
<span class="r-in"><span>                       data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule which will be used to select the next best dose</span></span></span>
<span class="r-in"><span><span class="co"># based on the class 'NextBestNCRM'</span></span></span>
<span class="r-in"><span><span class="va">myNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestNCRM-class.html">NextBestNCRM</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           overdose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           max_overdose_prob<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the next best dose</span></span></span>
<span class="r-in"><span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">myNextBest</span>,</span></span>
<span class="r-in"><span>                               doselimit<span class="op">=</span><span class="va">nextMaxDose</span>,</span></span>
<span class="r-in"><span>                               samples<span class="op">=</span><span class="va">samples</span>, model<span class="op">=</span><span class="va">model</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the stopping rules</span></span></span>
<span class="r-in"><span><span class="va">myStopping1</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingMinCohorts-class.html">StoppingMinCohorts</a></span><span class="op">(</span>nCohorts<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">myStopping2</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingTargetProb-class.html">StoppingTargetProb</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  prob<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">myStopping3</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingMinPatients-class.html">StoppingMinPatients</a></span><span class="op">(</span>nPatients<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Combine the stopping rules, obtaining (in this specific example) a list of stopping</span></span></span>
<span class="r-in"><span><span class="co"># rules of class 'StoppingAny'</span></span></span>
<span class="r-in"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">myStopping1</span> <span class="op">|</span> <span class="va">myStopping2</span><span class="op">)</span> <span class="op">|</span> <span class="va">myStopping3</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate if to stop the Trial</span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span>stopping<span class="op">=</span><span class="va">myStopping</span>, dose<span class="op">=</span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span></span>
<span class="r-in"><span>          samples<span class="op">=</span><span class="va">samples</span>, model<span class="op">=</span><span class="va">model</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Number of cohorts is 6 and thus reached the prespecified minimum number 3"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Probability for target toxicity is 30 % for dose 18 and thus below the required 50 %"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[3]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Number of patients is 8 and thus below the prespecified minimum number 20"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint end</span></span></span>
<span class="r-in"><span><span class="co"># nolint start</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create the data</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="Data-class.html">Data</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             cohort<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             doseGrid<span class="op">=</span></span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span></span>
<span class="r-in"><span>                 <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">10</span>, to<span class="op">=</span><span class="fl">80</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initialize the CRM model used to model the data</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="LogisticLogNormal-class.html">LogisticLogNormal</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.85</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           cov<span class="op">=</span></span></span>
<span class="r-in"><span>                             <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                    nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           ref_dose<span class="op">=</span><span class="fl">56</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set-up some MCMC parameters and generate samples from the posterior</span></span></span>
<span class="r-in"><span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>burnin<span class="op">=</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>                       step<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                       samples<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">94</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span>, <span class="va">options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule for dose increments and calculate the maximum dose allowed</span></span></span>
<span class="r-in"><span><span class="va">myIncrements</span> <span class="op">&lt;-</span> <span class="fu"><a href="IncrementsRelative-class.html">IncrementsRelative</a></span><span class="op">(</span>intervals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   increments<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.33</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">myIncrements</span>,</span></span>
<span class="r-in"><span>                       data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule which will be used to select the next best dose</span></span></span>
<span class="r-in"><span><span class="co"># based on the class 'NextBestNCRM'</span></span></span>
<span class="r-in"><span><span class="va">myNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestNCRM-class.html">NextBestNCRM</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           overdose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           max_overdose_prob<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the next best dose</span></span></span>
<span class="r-in"><span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">myNextBest</span>,</span></span>
<span class="r-in"><span>                               doselimit<span class="op">=</span><span class="va">nextMaxDose</span>,</span></span>
<span class="r-in"><span>                               samples<span class="op">=</span><span class="va">samples</span>, model<span class="op">=</span><span class="va">model</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the stopping rule such that the study would be stopped if at least 3</span></span></span>
<span class="r-in"><span><span class="co"># cohorts were already dosed within 1 +/- 0.2 of the next best dose</span></span></span>
<span class="r-in"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingCohortsNearDose-class.html">StoppingCohortsNearDose</a></span><span class="op">(</span>nCohorts <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                                      percentage <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate if to stop the trial</span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span>stopping<span class="op">=</span><span class="va">myStopping</span>,</span></span>
<span class="r-in"><span>          dose<span class="op">=</span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span></span>
<span class="r-in"><span>          data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "0 cohorts lie within 0.2% of the next best dose 20. This is below the required 3 cohorts"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint end</span></span></span>
<span class="r-in"><span><span class="co"># nolint start</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create the data</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="Data-class.html">Data</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             cohort<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             doseGrid<span class="op">=</span></span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span></span>
<span class="r-in"><span>                 <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">10</span>, to<span class="op">=</span><span class="fl">80</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initialize the CRM model used to model the data</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="LogisticLogNormal-class.html">LogisticLogNormal</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.85</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           cov<span class="op">=</span></span></span>
<span class="r-in"><span>                             <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                    nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           ref_dose<span class="op">=</span><span class="fl">56</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set-up some MCMC parameters and generate samples from the posterior</span></span></span>
<span class="r-in"><span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>burnin<span class="op">=</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>                       step<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                       samples<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">94</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span>, <span class="va">options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule for dose increments and calculate the maximum dose allowed</span></span></span>
<span class="r-in"><span><span class="va">myIncrements</span> <span class="op">&lt;-</span> <span class="fu"><a href="IncrementsRelative-class.html">IncrementsRelative</a></span><span class="op">(</span>intervals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   increments<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.33</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">myIncrements</span>,</span></span>
<span class="r-in"><span>                       data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule which will be used to select the next best dose</span></span></span>
<span class="r-in"><span><span class="co"># based on the class 'NextBestNCRM'</span></span></span>
<span class="r-in"><span><span class="va">myNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestNCRM-class.html">NextBestNCRM</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           overdose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           max_overdose_prob<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the next best dose</span></span></span>
<span class="r-in"><span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">myNextBest</span>,</span></span>
<span class="r-in"><span>                               doselimit<span class="op">=</span><span class="va">nextMaxDose</span>,</span></span>
<span class="r-in"><span>                               samples<span class="op">=</span><span class="va">samples</span>, model<span class="op">=</span><span class="va">model</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the stopping rule such that the study would be stopped if at least 9</span></span></span>
<span class="r-in"><span><span class="co"># patients were already dosed within 1 +/- 0.2 of the next best dose</span></span></span>
<span class="r-in"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingPatientsNearDose-class.html">StoppingPatientsNearDose</a></span><span class="op">(</span>nPatients <span class="op">=</span> <span class="fl">9</span>,</span></span>
<span class="r-in"><span>                                       percentage <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate if to stop the trial</span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span>stopping<span class="op">=</span><span class="va">myStopping</span>,</span></span>
<span class="r-in"><span>          dose<span class="op">=</span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span></span>
<span class="r-in"><span>          data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "0 patients lie within 0.2% of the next best dose 18. This is below the required 9 patients"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint end</span></span></span>
<span class="r-in"><span><span class="co"># nolint start</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create the data</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="Data-class.html">Data</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             cohort<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             doseGrid<span class="op">=</span></span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span></span>
<span class="r-in"><span>                 <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">10</span>, to<span class="op">=</span><span class="fl">80</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initialize the CRM model used to model the data</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="LogisticLogNormal-class.html">LogisticLogNormal</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.85</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           cov<span class="op">=</span></span></span>
<span class="r-in"><span>                             <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                    nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           ref_dose<span class="op">=</span><span class="fl">56</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set-up some MCMC parameters and generate samples from the posterior</span></span></span>
<span class="r-in"><span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>burnin<span class="op">=</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>                       step<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                       samples<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">94</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span>, <span class="va">options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule for dose increments and calculate the maximum dose allowed</span></span></span>
<span class="r-in"><span><span class="va">myIncrements</span> <span class="op">&lt;-</span> <span class="fu"><a href="IncrementsRelative-class.html">IncrementsRelative</a></span><span class="op">(</span>intervals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   increments<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.33</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">myIncrements</span>,</span></span>
<span class="r-in"><span>                       data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule which will be used to select the next best dose</span></span></span>
<span class="r-in"><span><span class="co"># based on the class 'NextBestNCRM'</span></span></span>
<span class="r-in"><span><span class="va">myNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestNCRM-class.html">NextBestNCRM</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           overdose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           max_overdose_prob<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the next best dose</span></span></span>
<span class="r-in"><span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">myNextBest</span>,</span></span>
<span class="r-in"><span>                               doselimit<span class="op">=</span><span class="va">nextMaxDose</span>,</span></span>
<span class="r-in"><span>                               samples<span class="op">=</span><span class="va">samples</span>, model<span class="op">=</span><span class="va">model</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the stopping rule such that the study would be stopped if at least 6</span></span></span>
<span class="r-in"><span><span class="co"># cohorts were already dosed</span></span></span>
<span class="r-in"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingMinCohorts-class.html">StoppingMinCohorts</a></span><span class="op">(</span>nCohorts <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate if to stop the trial</span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span>stopping<span class="op">=</span><span class="va">myStopping</span>,</span></span>
<span class="r-in"><span>          dose<span class="op">=</span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span></span>
<span class="r-in"><span>          data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Number of cohorts is 6 and thus reached the prespecified minimum number 6"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint end</span></span></span>
<span class="r-in"><span><span class="co"># nolint start</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create the data</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="Data-class.html">Data</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             cohort<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             doseGrid<span class="op">=</span></span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span></span>
<span class="r-in"><span>                 <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">10</span>, to<span class="op">=</span><span class="fl">80</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initialize the CRM model used to model the data</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="LogisticLogNormal-class.html">LogisticLogNormal</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.85</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           cov<span class="op">=</span></span></span>
<span class="r-in"><span>                             <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                    nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           ref_dose<span class="op">=</span><span class="fl">56</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set-up some MCMC parameters and generate samples from the posterior</span></span></span>
<span class="r-in"><span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>burnin<span class="op">=</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>                       step<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                       samples<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">94</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span>, <span class="va">options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule for dose increments and calculate the maximum dose allowed</span></span></span>
<span class="r-in"><span><span class="va">myIncrements</span> <span class="op">&lt;-</span> <span class="fu"><a href="IncrementsRelative-class.html">IncrementsRelative</a></span><span class="op">(</span>intervals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   increments<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.33</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">myIncrements</span>,</span></span>
<span class="r-in"><span>                       data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule which will be used to select the next best dose</span></span></span>
<span class="r-in"><span><span class="co"># based on the class 'NextBestNCRM'</span></span></span>
<span class="r-in"><span><span class="va">myNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestNCRM-class.html">NextBestNCRM</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           overdose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           max_overdose_prob<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the next best dose</span></span></span>
<span class="r-in"><span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">myNextBest</span>,</span></span>
<span class="r-in"><span>                               doselimit<span class="op">=</span><span class="va">nextMaxDose</span>,</span></span>
<span class="r-in"><span>                               samples<span class="op">=</span><span class="va">samples</span>, model<span class="op">=</span><span class="va">model</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the stopping rule such that the study would be stopped if at least 20</span></span></span>
<span class="r-in"><span><span class="co"># patients were already dosed</span></span></span>
<span class="r-in"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingMinPatients-class.html">StoppingMinPatients</a></span><span class="op">(</span>nPatients <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate if to stop the trial</span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span>stopping<span class="op">=</span><span class="va">myStopping</span>,</span></span>
<span class="r-in"><span>          dose<span class="op">=</span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span></span>
<span class="r-in"><span>          data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Number of patients is 8 and thus below the prespecified minimum number 20"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint end</span></span></span>
<span class="r-in"><span><span class="co"># nolint start</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create the data</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="Data-class.html">Data</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             cohort<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             doseGrid<span class="op">=</span></span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span></span>
<span class="r-in"><span>                 <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">10</span>, to<span class="op">=</span><span class="fl">80</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initialize the CRM model used to model the data</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="LogisticLogNormal-class.html">LogisticLogNormal</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.85</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           cov<span class="op">=</span></span></span>
<span class="r-in"><span>                             <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                    nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           ref_dose<span class="op">=</span><span class="fl">56</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set-up some MCMC parameters and generate samples from the posterior</span></span></span>
<span class="r-in"><span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>burnin<span class="op">=</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>                       step<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                       samples<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">94</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span>, <span class="va">options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule for dose increments and calculate the maximum dose allowed</span></span></span>
<span class="r-in"><span><span class="va">myIncrements</span> <span class="op">&lt;-</span> <span class="fu"><a href="IncrementsRelative-class.html">IncrementsRelative</a></span><span class="op">(</span>intervals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   increments<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.33</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">myIncrements</span>,</span></span>
<span class="r-in"><span>                       data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule which will be used to select the next best dose</span></span></span>
<span class="r-in"><span><span class="co"># based on the class 'NextBestNCRM'</span></span></span>
<span class="r-in"><span><span class="va">myNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestNCRM-class.html">NextBestNCRM</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           overdose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           max_overdose_prob<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the next best dose</span></span></span>
<span class="r-in"><span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">myNextBest</span>,</span></span>
<span class="r-in"><span>                               doselimit<span class="op">=</span><span class="va">nextMaxDose</span>,</span></span>
<span class="r-in"><span>                               samples<span class="op">=</span><span class="va">samples</span>, model<span class="op">=</span><span class="va">model</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the stopping rule such that the study would be stopped if there is at least</span></span></span>
<span class="r-in"><span><span class="co"># 0.5 posterior probability that [0.2 =&lt; Prob(DLT | next-best-dose) &lt;= 0.35]</span></span></span>
<span class="r-in"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingTargetProb-class.html">StoppingTargetProb</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                 prob<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate if to stop the trial</span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span>stopping<span class="op">=</span><span class="va">myStopping</span>,</span></span>
<span class="r-in"><span>          dose<span class="op">=</span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span></span>
<span class="r-in"><span>          samples<span class="op">=</span><span class="va">samples</span>,</span></span>
<span class="r-in"><span>          model<span class="op">=</span><span class="va">model</span>,</span></span>
<span class="r-in"><span>          data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Probability for target toxicity is 36 % for dose 20 and thus below the required 50 %"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint end</span></span></span>
<span class="r-in"><span><span class="co"># nolint start</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create the data</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="Data-class.html">Data</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             cohort<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             doseGrid<span class="op">=</span></span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span></span>
<span class="r-in"><span>                 <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">10</span>, to<span class="op">=</span><span class="fl">80</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initialize the CRM model used to model the data</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="LogisticLogNormal-class.html">LogisticLogNormal</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.85</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           cov<span class="op">=</span></span></span>
<span class="r-in"><span>                             <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                    nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           ref_dose<span class="op">=</span><span class="fl">56</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set-up some MCMC parameters and generate samples from the posterior</span></span></span>
<span class="r-in"><span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>burnin<span class="op">=</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>                       step<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                       samples<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">94</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span>, <span class="va">options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule for dose increments and calculate the maximum dose allowed</span></span></span>
<span class="r-in"><span><span class="va">myIncrements</span> <span class="op">&lt;-</span> <span class="fu"><a href="IncrementsRelative-class.html">IncrementsRelative</a></span><span class="op">(</span>intervals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   increments<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.33</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">myIncrements</span>,</span></span>
<span class="r-in"><span>                       data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule which will be used to select the next best dose</span></span></span>
<span class="r-in"><span><span class="co"># based on the class 'NextBestNCRM'</span></span></span>
<span class="r-in"><span><span class="va">myNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestNCRM-class.html">NextBestNCRM</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           overdose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           max_overdose_prob<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the next best dose</span></span></span>
<span class="r-in"><span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">myNextBest</span>,</span></span>
<span class="r-in"><span>                               doselimit<span class="op">=</span><span class="va">nextMaxDose</span>,</span></span>
<span class="r-in"><span>                               samples<span class="op">=</span><span class="va">samples</span>, model<span class="op">=</span><span class="va">model</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the stopping rule such that the study would be stopped if there is at least</span></span></span>
<span class="r-in"><span><span class="co"># 0.9 probability that MTD &gt; 0.5*next_best_dose. Here MTD is defined as the dose for</span></span></span>
<span class="r-in"><span><span class="co"># which prob(DLE)=0.33</span></span></span>
<span class="r-in"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingMTDdistribution-class.html">StoppingMTDdistribution</a></span><span class="op">(</span>target <span class="op">=</span> <span class="fl">0.33</span>,</span></span>
<span class="r-in"><span>                                      thresh <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>                                      prob <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate if to stop the trial</span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span>stopping<span class="op">=</span><span class="va">myStopping</span>,</span></span>
<span class="r-in"><span>          dose<span class="op">=</span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span></span>
<span class="r-in"><span>          samples<span class="op">=</span><span class="va">samples</span>,</span></span>
<span class="r-in"><span>          model<span class="op">=</span><span class="va">model</span>,</span></span>
<span class="r-in"><span>          data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Probability of MTD above 50 % of current dose 20 is 92 % and thus above the required 90 %"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint end</span></span></span>
<span class="r-in"><span><span class="co"># Create the data.</span></span></span>
<span class="r-in"><span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="Data-class.html">Data</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  doseGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">10</span>, to <span class="op">=</span> <span class="fl">80</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initialize the CRM model used to model the data.</span></span></span>
<span class="r-in"><span><span class="va">my_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="LogisticLogNormal-class.html">LogisticLogNormal</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.85</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ref_dose <span class="op">=</span> <span class="fl">56</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set-up some MCMC parameters and generate samples from the posterior.</span></span></span>
<span class="r-in"><span><span class="va">my_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  burnin <span class="op">=</span> <span class="fl">100</span>, step <span class="op">=</span> <span class="fl">2</span>, samples <span class="op">=</span> <span class="fl">2000</span>, rng_kind <span class="op">=</span> <span class="st">"Mersenne-Twister"</span>, rng_seed <span class="op">=</span> <span class="fl">94</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">my_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="va">my_model</span>, <span class="va">my_options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule for dose increments and calculate the maximum dose allowed.</span></span></span>
<span class="r-in"><span><span class="va">my_increments</span> <span class="op">&lt;-</span> <span class="fu"><a href="IncrementsRelative-class.html">IncrementsRelative</a></span><span class="op">(</span>intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>, increments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.33</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">next_max_dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">my_increments</span>, data <span class="op">=</span> <span class="va">my_data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule which will be used to select the next best dose</span></span></span>
<span class="r-in"><span><span class="co"># based on the class 'NextBestNCRM'.</span></span></span>
<span class="r-in"><span><span class="va">my_next_best</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestNCRM-class.html">NextBestNCRM</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  overdose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  max_overdose_prob <span class="op">=</span> <span class="fl">0.25</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the next best dose.</span></span></span>
<span class="r-in"><span><span class="va">dose_recommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">my_next_best</span>,</span></span>
<span class="r-in"><span>  doselimit <span class="op">=</span> <span class="va">next_max_dose</span>,</span></span>
<span class="r-in"><span>  samples <span class="op">=</span> <span class="va">my_samples</span>,</span></span>
<span class="r-in"><span>  model <span class="op">=</span> <span class="va">my_model</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">my_data</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the stopping rule such that the study would be stopped if the</span></span></span>
<span class="r-in"><span><span class="co"># the MTD can be estimated with sufficient precision, i.e. if robust coefficient</span></span></span>
<span class="r-in"><span><span class="co"># of variation is below 40%.</span></span></span>
<span class="r-in"><span><span class="va">my_stopping</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingMTDCV-class.html">StoppingMTDCV</a></span><span class="op">(</span>target <span class="op">=</span> <span class="fl">0.3</span>, thresh_cv <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate if to stop the trial.</span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span></span></span>
<span class="r-in"><span>  stopping <span class="op">=</span> <span class="va">my_stopping</span>,</span></span>
<span class="r-in"><span>  dose <span class="op">=</span> <span class="va">dose_recommendation</span><span class="op">$</span><span class="va">value</span>,</span></span>
<span class="r-in"><span>  samples <span class="op">=</span> <span class="va">my_samples</span>,</span></span>
<span class="r-in"><span>  model <span class="op">=</span> <span class="va">my_model</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">my_data</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "CV of MTD is 70 % and thus above the required precision threshold of 40 %"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create the data.</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="Data-class.html">Data</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  doseGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">10</span>, to <span class="op">=</span> <span class="fl">80</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initialize the CRM model used to model the data.</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="LogisticLogNormal-class.html">LogisticLogNormal</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.85</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ref_dose <span class="op">=</span> <span class="fl">56</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set-up some MCMC parameters and generate samples from the posterior.</span></span></span>
<span class="r-in"><span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  burnin <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  step <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  samples <span class="op">=</span> <span class="fl">2000</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">94</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span>, <span class="va">options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule for dose increments and calculate the maximum dose allowed.</span></span></span>
<span class="r-in"><span><span class="va">my_increments</span> <span class="op">&lt;-</span> <span class="fu"><a href="IncrementsRelative-class.html">IncrementsRelative</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  increments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.33</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">next_max_dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">my_increments</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule which will be used to select the next best dose</span></span></span>
<span class="r-in"><span><span class="co"># based on the class 'NextBestNCRM'.</span></span></span>
<span class="r-in"><span><span class="va">my_next_best</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestNCRM-class.html">NextBestNCRM</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  overdose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  max_overdose_prob <span class="op">=</span> <span class="fl">0.25</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the next best dose.</span></span></span>
<span class="r-in"><span><span class="va">dose_recommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">my_next_best</span>,</span></span>
<span class="r-in"><span>  doselimit <span class="op">=</span> <span class="va">next_max_dose</span>,</span></span>
<span class="r-in"><span>  samples <span class="op">=</span> <span class="va">samples</span>, model <span class="op">=</span> <span class="va">model</span>, data <span class="op">=</span> <span class="va">data</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the stopping rule such that the study would be stopped if first dose</span></span></span>
<span class="r-in"><span><span class="co"># is toxic based on a Beta posterior distribution with Beta(1,1) prior.</span></span></span>
<span class="r-in"><span><span class="va">my_stopping</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingLowestDoseHSRBeta-class.html">StoppingLowestDoseHSRBeta</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  target <span class="op">=</span> <span class="fl">0.3</span>,</span></span>
<span class="r-in"><span>  prob <span class="op">=</span> <span class="fl">0.9</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate if the trial will be stopped.</span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span></span></span>
<span class="r-in"><span>  stopping <span class="op">=</span> <span class="va">my_stopping</span>,</span></span>
<span class="r-in"><span>  dose <span class="op">=</span> <span class="va">dose_recommendation</span><span class="op">$</span><span class="va">value</span>,</span></span>
<span class="r-in"><span>  samples <span class="op">=</span> <span class="va">samples</span>,</span></span>
<span class="r-in"><span>  model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">data</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Probability that the lowest active dose of 0.1 being toxic based on posterior Beta distribution using a Beta(1,1) prior is 65% and thus below the required 90% threshold."</span>
<span class="r-in"><span><span class="co"># nolint start</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create the data</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="DataDual-class.html">DataDual</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span>,</span></span>
<span class="r-in"><span>      <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">40</span>, <span class="fl">40</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>,</span></span>
<span class="r-in"><span>      <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  w<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.31</span>, <span class="fl">0.42</span>, <span class="fl">0.59</span>, <span class="fl">0.45</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.55</span>, <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>      <span class="fl">0.52</span>, <span class="fl">0.54</span>, <span class="fl">0.56</span>, <span class="fl">0.43</span>, <span class="fl">0.41</span>, <span class="fl">0.39</span>, <span class="fl">0.34</span>, <span class="fl">0.38</span>, <span class="fl">0.21</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  doseGrid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span></span>
<span class="r-in"><span>             <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">10</span>, to<span class="op">=</span><span class="fl">80</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used best guess cohort indices!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initialize the Dual-Endpoint model (in this case RW1)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="DualEndpointRW-class.html">DualEndpointRW</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        sigma2betaW <span class="op">=</span> <span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>                        sigma2W <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0.1</span>, b<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        rho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">1</span>, b<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        rw1 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set-up some MCMC parameters and generate samples from the posterior</span></span></span>
<span class="r-in"><span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>burnin<span class="op">=</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>                       step<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                       samples<span class="op">=</span><span class="fl">500</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">94</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span>, <span class="va">options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule for dose increments and calculate the maximum dose allowed</span></span></span>
<span class="r-in"><span><span class="va">myIncrements</span> <span class="op">&lt;-</span> <span class="fu"><a href="IncrementsRelative-class.html">IncrementsRelative</a></span><span class="op">(</span>intervals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   increments<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.33</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">myIncrements</span>,</span></span>
<span class="r-in"><span>                       data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule which will be used to select the next best dose</span></span></span>
<span class="r-in"><span><span class="co"># In this case target a dose achieving at least 0.9 of maximum biomarker level (efficacy)</span></span></span>
<span class="r-in"><span><span class="co"># and with a probability below 0.25 that prob(DLT)&gt;0.35 (safety)</span></span></span>
<span class="r-in"><span><span class="va">myNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestDualEndpoint-class.html">NextBestDualEndpoint</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   overdose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   max_overdose_prob<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the next best dose</span></span></span>
<span class="r-in"><span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">myNextBest</span>,</span></span>
<span class="r-in"><span>                               doselimit<span class="op">=</span><span class="va">nextMaxDose</span>,</span></span>
<span class="r-in"><span>                               samples<span class="op">=</span><span class="va">samples</span>,</span></span>
<span class="r-in"><span>                               model<span class="op">=</span><span class="va">model</span>,</span></span>
<span class="r-in"><span>                               data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the stopping rule such that the study would be stopped if if there is at</span></span></span>
<span class="r-in"><span><span class="co"># least 0.5 posterior probability that the biomarker (efficacy) is within the</span></span></span>
<span class="r-in"><span><span class="co"># biomarker target range of [0.9, 1.0] (relative to the maximum for the biomarker).</span></span></span>
<span class="r-in"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingTargetBiomarker-class.html">StoppingTargetBiomarker</a></span><span class="op">(</span>target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                      prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate if to stop the trial</span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span>stopping<span class="op">=</span><span class="va">myStopping</span>,</span></span>
<span class="r-in"><span>          dose<span class="op">=</span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span></span>
<span class="r-in"><span>          samples<span class="op">=</span><span class="va">samples</span>,</span></span>
<span class="r-in"><span>          model<span class="op">=</span><span class="va">model</span>,</span></span>
<span class="r-in"><span>          data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Probability for target biomarker is 12 % for dose 12 and thus below the required 50 %"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint end</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create some data.</span></span></span>
<span class="r-in"><span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="Data-class.html">Data</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>,</span></span>
<span class="r-in"><span>  cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  doseGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">10</span>, to <span class="op">=</span> <span class="fl">80</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initialize the CRM model used to model the data.</span></span></span>
<span class="r-in"><span><span class="va">my_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="LogisticLogNormal-class.html">LogisticLogNormal</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.85</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ref_dose <span class="op">=</span> <span class="fl">50</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set-up some MCMC parameters and generate samples from the posterior.</span></span></span>
<span class="r-in"><span><span class="va">my_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>burnin <span class="op">=</span> <span class="fl">100</span>, step <span class="op">=</span> <span class="fl">2</span>, samples <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">my_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="va">my_model</span>, <span class="va">my_options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule which will be used to select the next best dose</span></span></span>
<span class="r-in"><span><span class="co"># based on the class 'NextBestNCRM'.</span></span></span>
<span class="r-in"><span><span class="va">my_nb_ncrm</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestNCRM-class.html">NextBestNCRM</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  overdose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  max_overdose_prob <span class="op">=</span> <span class="fl">0.25</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the next best dose.</span></span></span>
<span class="r-in"><span><span class="va">my_dose_recommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  nextBest <span class="op">=</span> <span class="va">my_nb_ncrm</span>,</span></span>
<span class="r-in"><span>  doselimit <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  samples <span class="op">=</span> <span class="va">my_samples</span>,</span></span>
<span class="r-in"><span>  model <span class="op">=</span> <span class="va">my_model</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">my_data</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the stopping rules.</span></span></span>
<span class="r-in"><span><span class="va">highest_dose_safe</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingSpecificDose-class.html">StoppingSpecificDose</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  rule <span class="op">=</span> <span class="fu"><a href="StoppingTargetProb-class.html">StoppingTargetProb</a></span><span class="op">(</span>target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span>, prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  dose <span class="op">=</span> <span class="fl">80</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">max_patients</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingMinPatients-class.html">StoppingMinPatients</a></span><span class="op">(</span>nPatients <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">patients_near_dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingPatientsNearDose-class.html">StoppingPatientsNearDose</a></span><span class="op">(</span>nPatients <span class="op">=</span> <span class="fl">3</span>, percentage <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create a list of stopping rules (of class 'StoppingList') which will then be</span></span></span>
<span class="r-in"><span><span class="co"># summarized (in this specific example) with the 'any' function, meaning that</span></span></span>
<span class="r-in"><span><span class="co"># the study would be stopped if 'any' of the single stopping rules is TRUE.</span></span></span>
<span class="r-in"><span><span class="va">my_stopping</span> <span class="op">&lt;-</span> <span class="va">highest_dose_safe</span> <span class="op">|</span> <span class="va">max_patients</span> <span class="op">|</span> <span class="va">patients_near_dose</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate if to stop the Trial</span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span></span></span>
<span class="r-in"><span>  stopping <span class="op">=</span> <span class="va">my_stopping</span>,</span></span>
<span class="r-in"><span>  dose <span class="op">=</span> <span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span></span>
<span class="r-in"><span>  samples <span class="op">=</span> <span class="va">samples</span>,</span></span>
<span class="r-in"><span>  model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">data</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Probability for target toxicity is 0 % for dose 80 and thus below the required 80 %"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Number of patients is 17 and thus below the prespecified minimum number 20"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[3]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "0 patients lie within 0% of the next best dose 12. This is below the required 3 patients"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># nolint start</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create the data</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="Data-class.html">Data</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">40</span>, <span class="fl">40</span>, <span class="fl">40</span>,</span></span>
<span class="r-in"><span>                 <span class="fl">80</span>, <span class="fl">80</span>, <span class="fl">80</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             cohort<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">7</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">8</span>, <span class="fl">8</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             doseGrid<span class="op">=</span></span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span></span>
<span class="r-in"><span>                 <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">10</span>, to<span class="op">=</span><span class="fl">80</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initialize the CRM model used to model the data</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="LogisticLogNormal-class.html">LogisticLogNormal</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.85</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           cov<span class="op">=</span></span></span>
<span class="r-in"><span>                             <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                    nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           ref_dose<span class="op">=</span><span class="fl">56</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set-up some MCMC parameters and generate samples from the posterior</span></span></span>
<span class="r-in"><span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>burnin<span class="op">=</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>                       step<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                       samples<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">94</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span>, <span class="va">options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule for dose increments and calculate the maximum dose allowed</span></span></span>
<span class="r-in"><span><span class="va">myIncrements</span> <span class="op">&lt;-</span> <span class="fu"><a href="IncrementsRelative-class.html">IncrementsRelative</a></span><span class="op">(</span>intervals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   increments<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.33</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">myIncrements</span>,</span></span>
<span class="r-in"><span>                       data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the rule which will be used to select the next best dose</span></span></span>
<span class="r-in"><span><span class="co"># based on the class 'NextBestNCRM'</span></span></span>
<span class="r-in"><span><span class="va">myNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestNCRM-class.html">NextBestNCRM</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           overdose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           max_overdose_prob<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the next best dose</span></span></span>
<span class="r-in"><span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">myNextBest</span>,</span></span>
<span class="r-in"><span>                               doselimit<span class="op">=</span><span class="va">nextMaxDose</span>,</span></span>
<span class="r-in"><span>                               samples<span class="op">=</span><span class="va">samples</span>, model<span class="op">=</span><span class="va">model</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the stopping rule such that the study would be stopped if there is at least</span></span></span>
<span class="r-in"><span><span class="co"># 0.5 posterior probability that [0.2 =&lt; Prob(DLT | next-best-dose) &lt;= 0.35]</span></span></span>
<span class="r-in"><span><span class="va">stopTarget</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingTargetProb-class.html">StoppingTargetProb</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                 prob<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## now use the StoppingHighestDose rule:</span></span></span>
<span class="r-in"><span><span class="va">stopHigh</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="StoppingHighestDose-class.html">StoppingHighestDose</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&amp;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="StoppingPatientsNearDose-class.html">StoppingPatientsNearDose</a></span><span class="op">(</span>nPatients<span class="op">=</span><span class="fl">3</span>, percentage<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">&amp;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="StoppingTargetProb-class.html">StoppingTargetProb</a></span><span class="op">(</span>target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     prob<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## and combine everything:</span></span></span>
<span class="r-in"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="va">stopTarget</span> <span class="op">|</span> <span class="va">stopHigh</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Then evaluate if to stop the trial</span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span>stopping<span class="op">=</span><span class="va">myStopping</span>,</span></span>
<span class="r-in"><span>          dose<span class="op">=</span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span></span>
<span class="r-in"><span>          samples<span class="op">=</span><span class="va">samples</span>,</span></span>
<span class="r-in"><span>          model<span class="op">=</span><span class="va">model</span>,</span></span>
<span class="r-in"><span>          data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Probability for target toxicity is 50 % for dose 64 and thus below the required 50 %"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[2]][[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Next best dose is 64 and thus not the highest dose"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[2]][[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "0 patients lie within 0% of the next best dose 64. This is below the required 3 patients"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")[[2]][[3]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Probability for target toxicity is 28 % for dose 64 and thus below the required 50 %"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint end</span></span></span>
<span class="r-in"><span><span class="co"># nolint start</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##define the stopping rules based on the 'StoppingTDCIRatio' class</span></span></span>
<span class="r-in"><span><span class="co">##Using only DLE responses with samples</span></span></span>
<span class="r-in"><span><span class="co">## we need a data object with doses &gt;= 1:</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">&lt;-</span><span class="fu"><a href="Data-class.html">Data</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">50</span>,<span class="fl">50</span>,<span class="fl">75</span>,<span class="fl">150</span>,<span class="fl">200</span>,<span class="fl">225</span>,<span class="fl">300</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           doseGrid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">25</span>,to<span class="op">=</span><span class="fl">300</span>,by<span class="op">=</span><span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used best guess cohort indices!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##model can be specified of 'Model' or 'ModelTox' class</span></span></span>
<span class="r-in"><span><span class="co">##For example, the 'logisticIndepBeta' class model</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">&lt;-</span><span class="fu"><a href="LogisticIndepBeta-class.html">LogisticIndepBeta</a></span><span class="op">(</span>binDLE<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.05</span>,<span class="fl">1.8</span><span class="op">)</span>,DLEweights<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>,DLEdose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">300</span><span class="op">)</span>,data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">##define MCMC options</span></span></span>
<span class="r-in"><span><span class="co">##for illustration purpose we use 10 burn-in and generate 50 samples</span></span></span>
<span class="r-in"><span><span class="va">options</span><span class="op">&lt;-</span><span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>burnin<span class="op">=</span><span class="fl">10</span>,step<span class="op">=</span><span class="fl">2</span>,samples<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">##samples of 'Samples' class</span></span></span>
<span class="r-in"><span><span class="va">samples</span><span class="op">&lt;-</span><span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">model</span>,<span class="va">options</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">##define the 'StoppingTDCIRatio' class</span></span></span>
<span class="r-in"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingTDCIRatio-class.html">StoppingTDCIRatio</a></span><span class="op">(</span>target_ratio <span class="op">=</span> <span class="fl">5</span>, prob_target <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">##Find the next Recommend dose using the nextBest method (plesae refer to nextbest examples)</span></span></span>
<span class="r-in"><span><span class="va">tdNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestTDsamples-class.html">NextBestTDsamples</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  prob_target_drt <span class="op">=</span> <span class="fl">0.35</span>, prob_target_eot <span class="op">=</span> <span class="fl">0.3</span>,</span></span>
<span class="r-in"><span>  derive <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">samples</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">samples</span>, probs <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">RecommendDose</span><span class="op">&lt;-</span><span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">tdNextBest</span>,doselimit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">@</span><span class="va">doseGrid</span><span class="op">)</span>,samples<span class="op">=</span><span class="va">samples</span>,</span></span>
<span class="r-in"><span>                        model<span class="op">=</span><span class="va">model</span>,data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">##use 'stopTrial' to determine if the rule has been fulfilled</span></span></span>
<span class="r-in"><span><span class="co">##use 0.3 as the target proability of DLE at the end of the trial</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span>stopping<span class="op">=</span><span class="va">myStopping</span>,dose<span class="op">=</span><span class="va">RecommendDose</span><span class="op">$</span><span class="va">next_dose_drt</span>,</span></span>
<span class="r-in"><span>          samples<span class="op">=</span><span class="va">samples</span>,model<span class="op">=</span><span class="va">model</span>,data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Recommended next best dose is NA"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint end</span></span></span>
<span class="r-in"><span><span class="co"># nolint start</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##define the stopping rules based on the 'StoppingTDCIRatio' class</span></span></span>
<span class="r-in"><span><span class="co">##Using only DLE responses</span></span></span>
<span class="r-in"><span><span class="co">## we need a data object with doses &gt;= 1:</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">&lt;-</span><span class="fu"><a href="Data-class.html">Data</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">50</span>,<span class="fl">50</span>,<span class="fl">75</span>,<span class="fl">150</span>,<span class="fl">200</span>,<span class="fl">225</span>,<span class="fl">300</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           doseGrid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">25</span>,to<span class="op">=</span><span class="fl">300</span>,by<span class="op">=</span><span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used best guess cohort indices!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##model must be of 'ModelTox' class</span></span></span>
<span class="r-in"><span><span class="co">##For example, the 'logisticIndepBeta' class model</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">&lt;-</span><span class="fu"><a href="LogisticIndepBeta-class.html">LogisticIndepBeta</a></span><span class="op">(</span>binDLE<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.05</span>,<span class="fl">1.8</span><span class="op">)</span>,DLEweights<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>,DLEdose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">300</span><span class="op">)</span>,data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">##define the 'StoppingTDCIRatio' class</span></span></span>
<span class="r-in"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingTDCIRatio-class.html">StoppingTDCIRatio</a></span><span class="op">(</span>target_ratio <span class="op">=</span> <span class="fl">5</span>, prob_target <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">##Find the next Recommend dose using the nextBest method (plesae refer to nextbest examples)</span></span></span>
<span class="r-in"><span><span class="va">tdNextBest</span><span class="op">&lt;-</span><span class="fu"><a href="NextBestTD-class.html">NextBestTD</a></span><span class="op">(</span>prob_target_drt<span class="op">=</span><span class="fl">0.35</span>,prob_target_eot<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">RecommendDose</span><span class="op">&lt;-</span><span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">tdNextBest</span>,doselimit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">@</span><span class="va">doseGrid</span><span class="op">)</span>,model<span class="op">=</span><span class="va">model</span>,data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">##use 'stopTrial' to determine if the rule has been fulfilled</span></span></span>
<span class="r-in"><span><span class="co">##use 0.3 as the target proability of DLE at the end of the trial</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span>stopping<span class="op">=</span><span class="va">myStopping</span>,dose<span class="op">=</span><span class="va">RecommendDose</span><span class="op">$</span><span class="va">next_dose_drt</span>,</span></span>
<span class="r-in"><span>          model<span class="op">=</span><span class="va">model</span>,data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"messgae")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "95% CI is ( 15.2619 , 173.8695 ), Ratio = 11.3924 is  greater than target_ratio = 5"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint end</span></span></span>
<span class="r-in"><span><span class="co"># nolint start</span></span></span>
<span class="r-in"><span><span class="co">##define the stopping rules based on the 'StoppingMaxGainCIRatio' class</span></span></span>
<span class="r-in"><span><span class="co">##Using both DLE and efficacy responses</span></span></span>
<span class="r-in"><span><span class="co">## we need a data object with doses &gt;= 1:</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span><span class="fu"><a href="DataDual-class.html">DataDual</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">50</span>,<span class="fl">25</span>,<span class="fl">50</span>,<span class="fl">75</span>,<span class="fl">300</span>,<span class="fl">250</span>,<span class="fl">150</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                w<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.31</span>,<span class="fl">0.42</span>,<span class="fl">0.59</span>,<span class="fl">0.45</span>,<span class="fl">0.6</span>,<span class="fl">0.7</span>,<span class="fl">0.6</span>,<span class="fl">0.52</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                doseGrid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">300</span>,<span class="fl">25</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                placebo<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used best guess cohort indices!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##DLEmodel must be of 'ModelTox' class</span></span></span>
<span class="r-in"><span><span class="co">##For example, the 'logisticIndepBeta' class model</span></span></span>
<span class="r-in"><span><span class="va">DLEmodel</span><span class="op">&lt;-</span><span class="fu"><a href="LogisticIndepBeta-class.html">LogisticIndepBeta</a></span><span class="op">(</span>binDLE<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.05</span>,<span class="fl">1.8</span><span class="op">)</span>,DLEweights<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>,DLEdose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">300</span><span class="op">)</span>,data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##Effmodel must be  of 'ModelEff' class</span></span></span>
<span class="r-in"><span><span class="co">##For example, the 'Effloglog' class model</span></span></span>
<span class="r-in"><span><span class="va">Effmodel</span><span class="op">&lt;-</span><span class="fu"><a href="Effloglog-class.html">Effloglog</a></span><span class="op">(</span>eff<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.223</span>,<span class="fl">2.513</span><span class="op">)</span>,eff_dose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">300</span><span class="op">)</span>,nu<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">1</span>,b<span class="op">=</span><span class="fl">0.025</span><span class="op">)</span>,data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">##for illustration purpose we use 10 burn-in and generate 50 samples</span></span></span>
<span class="r-in"><span><span class="va">options</span><span class="op">&lt;-</span><span class="fu"><a href="McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>burnin<span class="op">=</span><span class="fl">10</span>,step<span class="op">=</span><span class="fl">2</span>,samples<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">##DLE and efficacy samples must be of 'Samples' class</span></span></span>
<span class="r-in"><span><span class="va">DLEsamples</span><span class="op">&lt;-</span><span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">DLEmodel</span>,<span class="va">options</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Effsamples</span><span class="op">&lt;-</span><span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">Effmodel</span>,<span class="va">options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##define the 'StoppingMaxGainCIRatio' class</span></span></span>
<span class="r-in"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingMaxGainCIRatio-class.html">StoppingMaxGainCIRatio</a></span><span class="op">(</span>target_ratio <span class="op">=</span> <span class="fl">5</span>, prob_target <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">##Find the next Recommend dose using the nextBest method (plesae refer to nextbest examples)</span></span></span>
<span class="r-in"><span><span class="va">mynextbest</span> <span class="op">&lt;-</span> <span class="fu"><a href="NextBestMaxGainSamples-class.html">NextBestMaxGainSamples</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  prob_target_drt <span class="op">=</span> <span class="fl">0.35</span>,</span></span>
<span class="r-in"><span>  prob_target_eot <span class="op">=</span> <span class="fl">0.3</span>,</span></span>
<span class="r-in"><span>  derive <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">samples</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">samples</span>, prob <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>,</span></span>
<span class="r-in"><span>  mg_derive <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">mg_samples</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">mg_samples</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">RecommendDose</span><span class="op">&lt;-</span><span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">mynextbest</span>,doselimit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">@</span><span class="va">doseGrid</span><span class="op">)</span>,samples<span class="op">=</span><span class="va">DLEsamples</span>,model<span class="op">=</span><span class="va">DLEmodel</span>,</span></span>
<span class="r-in"><span>                        data<span class="op">=</span><span class="va">data</span>,model_eff<span class="op">=</span><span class="va">Effmodel</span>,samples_eff<span class="op">=</span><span class="va">Effsamples</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Estimated TD 35 = 14.8679719869239 not within dose grid"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Estimated TD 30 = 9.60973788445752 not within dose grid"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Estimated max gain dose = 300 not within dose grid"</span>
<span class="r-in"><span><span class="co">##use 'stopTrial' to determine if the rule has been fulfilled</span></span></span>
<span class="r-in"><span><span class="co">##use 0.3 as the target proability of DLE at the end of the trial</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span>stopping<span class="op">=</span><span class="va">myStopping</span>,</span></span>
<span class="r-in"><span>          dose<span class="op">=</span><span class="va">RecommendDose</span><span class="op">$</span><span class="va">next_dose</span>,</span></span>
<span class="r-in"><span>          samples<span class="op">=</span><span class="va">DLEsamples</span>,</span></span>
<span class="r-in"><span>          model<span class="op">=</span><span class="va">DLEmodel</span>,</span></span>
<span class="r-in"><span>          data<span class="op">=</span><span class="va">data</span>,</span></span>
<span class="r-in"><span>          TDderive<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">TDsamples</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>            <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">TDsamples</span>,prob<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span><span class="op">}</span>,</span></span>
<span class="r-in"><span>          Effmodel<span class="op">=</span><span class="va">Effmodel</span>,</span></span>
<span class="r-in"><span>          Effsamples<span class="op">=</span><span class="va">Effsamples</span>,</span></span>
<span class="r-in"><span>          Gstarderive<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">Gstarsamples</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>            <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Gstarsamples</span>,prob<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Recommended next best dose is NA"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint end</span></span></span>
<span class="r-in"><span><span class="co"># nolint start</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##define the stopping rules based on the 'StoppingMaxGainCIRatio' class</span></span></span>
<span class="r-in"><span><span class="co">##Using both DLE and efficacy responses</span></span></span>
<span class="r-in"><span><span class="co">## we need a data object with doses &gt;= 1:</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span><span class="fu"><a href="DataDual-class.html">DataDual</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">50</span>,<span class="fl">25</span>,<span class="fl">50</span>,<span class="fl">75</span>,<span class="fl">300</span>,<span class="fl">250</span>,<span class="fl">150</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                w<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.31</span>,<span class="fl">0.42</span>,<span class="fl">0.59</span>,<span class="fl">0.45</span>,<span class="fl">0.6</span>,<span class="fl">0.7</span>,<span class="fl">0.6</span>,<span class="fl">0.52</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                doseGrid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">300</span>,<span class="fl">25</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                placebo<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used default patient IDs!</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Used best guess cohort indices!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##DLEmodel must be of 'ModelTox' class</span></span></span>
<span class="r-in"><span><span class="co">##For example, the 'logisticIndepBeta' class model</span></span></span>
<span class="r-in"><span><span class="va">DLEmodel</span><span class="op">&lt;-</span><span class="fu"><a href="LogisticIndepBeta-class.html">LogisticIndepBeta</a></span><span class="op">(</span>binDLE<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.05</span>,<span class="fl">1.8</span><span class="op">)</span>,DLEweights<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>,DLEdose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">300</span><span class="op">)</span>,data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##Effmodel must be  of 'ModelEff' class</span></span></span>
<span class="r-in"><span><span class="co">##For example, the 'Effloglog' class model</span></span></span>
<span class="r-in"><span><span class="va">Effmodel</span><span class="op">&lt;-</span><span class="fu"><a href="Effloglog-class.html">Effloglog</a></span><span class="op">(</span>eff<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.223</span>,<span class="fl">2.513</span><span class="op">)</span>,eff_dose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">300</span><span class="op">)</span>,nu<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">1</span>,b<span class="op">=</span><span class="fl">0.025</span><span class="op">)</span>,data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##define the 'StoppingMaxGainCIRatio' class</span></span></span>
<span class="r-in"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="fu"><a href="StoppingMaxGainCIRatio-class.html">StoppingMaxGainCIRatio</a></span><span class="op">(</span>target_ratio <span class="op">=</span> <span class="fl">5</span>, prob_target <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">##Find the next Recommend dose using the nextBest method (plesae refer to nextbest examples)</span></span></span>
<span class="r-in"><span><span class="va">mynextbest</span><span class="op">&lt;-</span><span class="fu"><a href="NextBestMaxGain-class.html">NextBestMaxGain</a></span><span class="op">(</span>prob_target_drt<span class="op">=</span><span class="fl">0.35</span>, prob_target_eot<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">RecommendDose</span><span class="op">&lt;-</span><span class="fu"><a href="nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">mynextbest</span>,doselimit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">@</span><span class="va">doseGrid</span><span class="op">)</span>,model<span class="op">=</span><span class="va">DLEmodel</span>,</span></span>
<span class="r-in"><span>                        model_eff<span class="op">=</span><span class="va">Effmodel</span>,data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##use 'stopTrial' to determine if the rule has been fulfilled</span></span></span>
<span class="r-in"><span><span class="co">##use 0.3 as the target proability of DLE at the end of the trial</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">stopTrial</span><span class="op">(</span>stopping<span class="op">=</span><span class="va">myStopping</span>,dose<span class="op">=</span><span class="va">RecommendDose</span><span class="op">$</span><span class="va">next_dose</span>,model<span class="op">=</span><span class="va">DLEmodel</span>,</span></span>
<span class="r-in"><span>          data<span class="op">=</span><span class="va">data</span>, Effmodel<span class="op">=</span><span class="va">Effmodel</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"message")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Gstar estimate is 94.942 with 95% CI ( 16.771 , 537.4745 ) and its ratio = 32.0479"                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] "TDtargetEndOfTrial estimate is  81.4924 with 95% CI ( 24.3435 , 272.804 ) and its ratio= 11.2064"   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "TDatrgetEndOfTrial estimate is smaller with ratio = 11.2064 which is  greater than target_ratio = 5"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># nolint end</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Daniel Sabanes Bove, Wai Yin Yeung, Burak Kuersad Guenhan, Giuseppe Palermo, Thomas Jaki, Jiawen Zhu, Ziwei Liao, Dimitris Kontos, Marlene Schulte-Goebel, Doug Kelkhoff.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

